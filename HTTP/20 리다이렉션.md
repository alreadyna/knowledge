# 20. 리다이렉션과 부하 균형

- 리다이렉션 기술: HTTP 메시지의 최종 목적지를 결정하는 네트워크 도구, 기법, 프로토콜

  보통 메시지가 프락시, 캐시, 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위하여 사용된다.

HTTP 메시지의 데이터는 전송되는 과정에서 많은 프로토콜에 영향을 받는다. HTTP가 고려하는 것은 request와 response 뿐이지만, 미러링된 서버/웹 프락시/캐시도 영향을 미치기에 HTTP 메시지의 목적지는 단순하게 설정되지는 않는다.



### 20.1 왜 리다이렉트인가?

HTTP 애플리케이션에서 원하는 것

- 신뢰할 수 있는 HTTP 트랜잭션의 수행
- 지연 최소화
- 네트워크 대역폭 절약



이러한 이유들 때문에 웹 콘텐츠는 여러 장소에 배포되어 신뢰성이 개선/응답 시간의 절약/네트워크 혼잡도 감소된다.

리다이렉션이란 최적의 분산된 콘텐츠를 찾는 것을 도와주는 기법의 집합이라 생각할 수 있다.



리다이렉션의 구현에는 부하 균형의 과제가 포함되는데, 왜냐하면 둘은 서로 공존하기 때문이다. 들어오는 메시지의 부하를 서버들의 집합에게 분산할 수 있다.



### 20.2 리다이렉트 할 곳

클라이언트에게 서버는 서버 뿐 아니라 프락시, 캐시, 게이트웨이를 생각한다. (서버, 프락시, 캐시, 게이트웨이는 클라이언트가 그들에게 HTTP 요청을 보내고 그들이 그것을 처리한다는 관점)

**웹 서버**는 IP 별로 요청을 다룬다. 똑같이 복제된 서버들로 요청을 분산한다는 것은 같은 URL에 대해 여러 곳에서 온 요청들을 각각 최적의 웹 서버로 보내겠다는 것을 의미한다 (클라이언트에서 가장 가까운 것이나 부하가 가장 적은 것, 혹은 그 외의 이유로 최적인 것)

**프락시**는 프로토콜 별로 요청을 다룬다. 프락시로의 리다이렉트는 주 진입로의 트래픽을 근처에 있는 지름길로 빨아들이는 것과 같다.



### 20.3 리다이렉션 프로토콜의 개요

리다이렉션의 목표: HTTP 메시지를 가용한 웹 서버로 가급적 빨리 보내는 것

- 부라우저 애플리케이션의 사용자는 브라우저가 클라이언트 메시지를 프락시 서버로 보내도록 설정할 수 있다.
- DNS 분석자는 메시지의 주소를 지정할 때 사용될 아이피 주소를 선택한다. 이 아이피 주소는 클라이언트의 지리적 위치에 따라 달라질 수 있다.
- 메시지는 주소가 지정된 여러 개의 패킷으로 나뉘어 네트워크를 통과한다. 스위치와 라우터들은 패킷의 TCP/IP 주소를 검증하고 그에 근거하여 패킷을 어떻게 라우팅 할 것인지 결정한다.
- 웹 서버는 HTTP 리다이렉트를 이용해 요청이 다른 웹 서버로 가도록 할 수 있다.



1. 일반 리다이렉션 방법

![IMG_0596](/Users/mina/Downloads/IMG_0596.jpg)



2. 프락시와 캐시 리다이렉션 기법

![IMG_0597](/Users/mina/Downloads/IMG_0597.jpg)



### 20.4 일반적인 리다이렉션 방법

##### 1. HTTP 리다이렉션

간단하게 부하를 분산

![IMG_0598](/Users/mina/Downloads/IMG_0598.jpg)





### 20.5 프락시 리다이렉션 방법

콘텐츠에 접근할 때 프락시를 통할 필요가 있는 경우도 있으며, 클라이언트가 이용하면 유익한 프락시 캐시가 네트워크에 있을 수도 있다. (캐시된 콘텐츠를 받는 것이 원 서버에 직접 가는 것 보다 훨씬 빠름)



### 20.6 캐시 리다이렉션 방법

캐싱 프락시 서버를 위해 사용되는 리다이렉션 기법으로 신뢰성 높고, 고성능, 콘텐츠 지각 디스패칭까지 가능하기에 좀 더 복잡하다.