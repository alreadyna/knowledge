# 18. 웹 호스팅

콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 '웹 호스팅'이라고 한다.

이 장에서는 웹 호스팅 서비스의 가장 중요한 속성 몇 가지와 그것들이 어떻게 HTTP 애플리케이션과 상호작용하는지 설명한다.

- 여러 웹 사이트를 같은 서버에 "가상 호스팅" 하는 방법. 그리고 그것이 HTTP에 끼치는 영향
- 트래픽이 많은 상황에서 안정적인 사이트를 구축하는 방법
- 웹 사이트 로딩을 더 빠르게 하는 방법



### 18.1 호스팅 서비스

 웹이 빠르게 대세가 되면서 웹 사이트에 대한 니즈는 커졌지만, 서버실을 짓고 도메인 이름을 등록하고 네트워크 대역폭을 구매할 기술과 시간을 가진 사람은 드물었다 -> 리소스 절약을 위해 이를 전문적으로 관리하는 웹 호스팅 서비스 업체가 생김 (물리적인 장비에서부터 고객이 직접 콘텐츠를 제공할 수 있는 총체적인 웹 호스팅까지 다양한 종류의 서비스들이 있다.)

**18.1.1 간단한 예 : 전용 호스팅**

그림18-1

![IMG_0500](/Users/mina/Downloads/IMG_0500.JPG)



### 18.2 가상 호스팅

컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스를 제공한다. 이를 공유 호스팅 혹은 가상 호스팅이라고 부른다.

각 웹 사이트는 다른 서버에서 호스팅하는 것처럼 보이겠지만, 사실은 물리적으로 같은 서버에서 호스팅되는 것이다. 

**18.2.1 호스트 정보가 없는 가상 서버 요청**

HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을 제공하지 않는다.

웹 서버는 사용자가 어떤 웹 사이트로 접근하려고 하는지 확인하는 데 필요한 정보가 충분하지 않다.

**18.2.2 가상 호스팅 동작하게 하기**

HTTP/1.0 에서는 가상 호스팅을 고려하지 않았기에 HTTP 요청 메시지에 경로 컴포넌트와 완전한 URL도 포함하여 보냈다.

HTTP/1.1을 지원하는 서버는 HTTP 요청 메시지에 있는 전체 URL을 처리할 수 있어야 한다. 업그레이드까지 시간이 소요되었고, 아래 4가지 기술이 추가로 발현

- URL 경로를 통한 가상 호스팅: 서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특별한 경로 컴포넌트를 추가
- 포트번호를 통한 가상 호스팅: 각 사이트에 다른 포트번호를 할당하여, 분리된 웹 서버의 인스턴스가 요청을 처리
  - IP 주소 부족 문제가 생길 수 있음에도 널리 쓰인다.
- IP 주소를 통한 가상 호스팅: 각 가상 사이트에 별도의 IP 주소를 할당하고 모든 IP 주소를 장비 하나에 연결, 웹 서버는 IP 주소로 사이트 이름을 식별
- Host 헤더를 통한 가상 호스팅: HTTP/1.0의 개선 버전과 HTTP/1.1의 공식 버전은 사이트 이름을 알려주는 Host 요청 헤더를 정의

**18.2.3 HTTP/1.1 Host 헤더**

Host 헤더는 RFC 2068에 정의되어 있는 HTTP/1.1 요청 헤더다.

![스크린샷 2021-06-17 오전 7.48.02](/Users/mina/Desktop/스크린샷 2021-06-17 오전 7.48.02.png)



### 18.3 안정적인 웹 사이트 만들기

웹사이트 장애 발생 상황

- 서버 다운
- 트래픽 폭증
- 네트워크 장애나 손실

**18.3.1 미러링 된 서버 팜**

서버 팜은 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합이다. 보통, 미러링 된 서버는 계층적인 관계에 있는데 한 서버 (원본 콘텐츠를 가지고 있는, 원 서버) 는 '콘텐츠의 원본 제작자' 같이 행동한다.

![IMG_0501](/Users/mina/Downloads/IMG_0501.JPG)

![IMG_0502](/Users/mina/Downloads/IMG_0502.JPG)

분산 미러링된 서버에서는, 클라이언트의 요청이 특정 서버로 가는 두 가지 방법이 있다.

- HTTP 리다이렉션: 콘텐츠에 대한 URL은 마스터 서버의 IP를 가리키고, 마스터 서버는 요청을 받는 즉시 복제 서버로 리다이렉트 시킨다.
- DNS 리다이렉션: 콘텐츠의 URL은 네 개의 IP 주소를 가리킬 수 있고, DNS 서버는 클라이언트에게 전송할 IP 주소를 선택할 수 있다.

**18.3.2 콘텐츠 분산 네트워크 (CDN)**

특정 콘텐츠의 분산을 목적으로 하는 단순한 네트워크이다. 네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있다.

**18.3.3 CDN의 대리 캐시**

대리 캐시는 원 서버를 대신해 사용될 수 있다.

리버스 프락시라고도 불리는 대리 서버는 미러링 된 웹 서버처럼 콘텐츠에 대한 요청을 받는다.

대리 서버와 미러링 된 서버의 차이점은, 대리 서버는 보통 수요에 따라서 동작한다는 것이다.

**18.3.4 CDN의 프락시 캐시**

요청이 있을 때만 저장하는 프락시 캐시는 레이어2 혹은 레이어3 장비(스위치 혹은 라우터)가 중간에서 웹 트래픽을 가로채 처리하기도 한다. 



### 18.4 웹 사이트 빠르게 만들기

서버 팜이나 분산 프랙시 캐시, 대리 서버는 혼잡을 조절하고 네트워크 트래픽을 분산시킨다.

콘텐츠를 분산시키면, 그 콘텐츠를 사용자에게 더 가깝게 만들어 주므로 콘텐츠 서버에서 클라이언트로의 전송하는 시간이 단축된다.

리소스의 로딩 속도를 좌우하는 핵심 요소는, 어떻게 요청과 응답이 클라이언트와 서버 사이에서 연결을 맺고 인터넷을 가로질러 데이터를 전송하는지다.(리다이렉트, 20장)

콘텐츠를 인코딩하는 것 또한 속도를 높일 수 있다.