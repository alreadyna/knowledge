# 11. 클라이언트 식별과 쿠키

웹 서버는 요청을 보낸 사용자를 식별하거나 방문자가 보낸 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있다. 
아마존과 같이 웹 사이트들은 개인화된 서비스를 제공하고 싶어 하는데, 이 때 HTTP에서 사용자 식별이 가능하도록 정보를 제공한다.

- 사용자 식별 관련 정보를 전달하는 HTTP 헤더들
- 클라이언트 IP 주소 추적으로 알아낸 IP 주소로 사용자를 식별
- 사용자 로그인을 통한 사용자 식별
- URL에 식별자를 포함하는 기술인 fat URL
- 식별 정보를 지속해서 유지하는 강력하면서도 효율적인 기술인 쿠키



### 11.2 HTTP 헤더

사용자 식별에 활용되는 헤더는 From, User-Agent, Referer 3가지 이다.

![68F26753-9A1C-4076-8E3B-F989B92A9E3F_1_105_c](/Users/mina/Pictures/Photos Library.photoslibrary/resources/derivatives/6/68F26753-9A1C-4076-8E3B-F989B92A9E3F_1_105_c.jpeg)



### 11.3 클라이언트 IP 주소

세션 간 사용자를 추적하기 위해 클라이언트 IP 주소를 사용하는 웹사이트가 있지만, 제대로 동작하지 않을 가능성이 있기에 사용하지 않는다.



### 11.4 사용자 로그인

사용자 이름과 비밀번호 인증 (로그인) 을 요구하여 명시적인 식별 정보를 요청할 수 있다. 사이트에 한 번만 로그인하면, 브라우저는 요청마다 해당 사용자의 식별정보 토큰을 Authorization 헤더에 담아 서버로 전송하여 한 세션이 진행되는 내내 그 사용자에 대한 식별을 유지한다.



### 11.5 뚱뚱한 URL

URL에 식별번호를 추가하여 사용자를 추적한다. 웹 서버와 통신하는 독립적인 HTTP 트랜잭션을 하나의 '세션' 혹은 '방문'으로 묶는 용도로 뚱뚱한 URL을 사용할 수 있다.



### 11.6 쿠키

쿠키는 사용자를 식별하고 세션을 유지하는 방식 중 현재까지 가장 널리 사용하는 방식이다.

11.6.1 쿠키의 타입

- 세션 쿠키: 사용자가 사이트를 탐색할 때, 관련한 설정과 선호 사항들을 저장하는 임시 쿠키. 사용자가 브라우저를 닫으면 삭제된다. Discard 파라미터가 설정되어 있거나, 파기되기까지 남은 시간을 가리키는 Expires 혹은 Max-Age 파라미터가 없으면 세션 쿠키가 된다.
- 지속 쿠키: 삭제되지 않고 더 길게 유지된다. 디스크에 저장되어 브라우저를 닫거나 컴퓨터를 재시작해도 남아있다. 

11.6.2 쿠키는 어떻게 동작하는가

![BF863D15-70E8-4216-AF2D-2C3658AE2C38_1_105_c](/Users/mina/Pictures/Photos Library.photoslibrary/resources/derivatives/B/BF863D15-70E8-4216-AF2D-2C3658AE2C38_1_105_c.jpeg)

11.6.3 쿠키 상자: 클라이언트 측 상태

쿠키의 기본적인 발상은 브라우저가 서버 관련 정보를 저장하고, 사용자가 해당 서버에 접근할 때 마다 그 정보를 함께 전송하게 하는 것이다.

ex - 구글 크롬 쿠키

![스크린샷 2021-05-13 오전 1.37.00](/Users/mina/Desktop/스크린샷 2021-05-13 오전 1.37.00.png)



11.6.4 사이트마다 각기 다른 쿠키들

브라우저는 쿠키를 생성한 서버에게만 쿠키에 담긴 정보를 전달한다. 



11.6.8 쿠키와 세션 추적

![8E12F7F2-A05E-4783-BDB6-EA31CD8AA64D_1_105_c](/Users/mina/Pictures/Photos Library.photoslibrary/resources/derivatives/8/8E12F7F2-A05E-4783-BDB6-EA31CD8AA64D_1_105_c.jpeg)



![CD513A03-C805-48B0-ADE1-BB8CF4899EC8_1_105_c](/Users/mina/Pictures/Photos Library.photoslibrary/resources/derivatives/C/CD513A03-C805-48B0-ADE1-BB8CF4899EC8_1_105_c.jpeg)



11.6.9 쿠키와 캐싱

쿠키 트랜잭션과 관련된 문서를 캐싱하는 것은 주의해야 한다. (개인정보 이슈)



11.6.10 쿠키, 보안, 그리고 개인정보

개인정보를 다루거나 사용자를 추적하는 기술은 잘못된 의도로 사용될 수 있기에 항상 조심해야 한다. 